<!doctype html>
<html lang="ru" data-theme="subsurface">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>–¢–µ–≥–∏ ‚Äî –î–æ—Å–∫–∞ —Å–µ–∫—Ç–æ—Ä–∞</title>
  <meta name="theme-color" content="#0b0f14"/>

  <script src="/assets/metrika.js"></script>



  <style>
    :root{--bg:#0b0f14;--panel:#0e141d;--text:#e6edf5;--muted:#9fb0c7;--tag:#112131;--tag-on:#183140;--link:#bfe9ff;--ring:#7dd3fc;--r:14px;--shadow:0 1px 0 rgba(255,255,255,.03) inset, 0 8px 30px rgba(0,0,0,.35)}
    html,body{height:100%} body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
    a{color:var(--link);text-decoration:none} a:hover{text-decoration:underline}
    .kx-head{position:sticky;top:0;z-index:10;display:flex;align-items:center;justify-content:space-between;padding:10px 16px;background:linear-gradient(180deg,rgba(0,0,0,.35),rgba(0,0,0,0));backdrop-filter:saturate(1.1) blur(6px);border-bottom:1px solid rgba(255,255,255,.05)}
    .kx-brand{font-weight:800;color:var(--text)} .kx-nav{display:flex;gap:8px;align-items:center}
    .kx-btn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:12px;background:var(--tag);border:1px solid rgba(255,255,255,.06);box-shadow:var(--shadow);color:var(--text)}
    .kx-btn:hover{transform:translateY(-1px)} .is-active{outline:2px solid var(--ring)}
    .kx-shell{max-width:1000px;margin:0 auto;padding:16px}
    .kx-panel{background:linear-gradient(180deg,rgba(255,255,255,.02),transparent),var(--panel);border:1px solid rgba(255,255,255,.06);border-radius:var(--r);box-shadow:var(--shadow);padding:18px}
    .tags{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px}
    .kx-tag{display:inline-flex;align-items:center;padding:4px 8px;border-radius:10px;background:var(--tag);color:var(--muted);font-size:12px;border:1px solid rgba(255,255,255,.06)}
    .kx-tag.on{background:var(--tag-on);color:var(--text)}
    .item{border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:12px;background:rgba(255,255,255,.02);margin-bottom:8px}
    .muted{color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <header class="kx-head">
    <a class="kx-brand" href="/index.html">–î–æ—Å–∫–∞ –ö–∞–π–Ω—Ä–∞–∫—Å</a>
    <nav class="kx-nav">
      <a class="kx-btn" href="/index.html">–¢–µ–º—ã</a>
      <a class="kx-btn" href="/people.html">–í—Å–µ –ª—é–¥–∏</a>
      <a class="kx-btn is-active" href="/tags.html">–¢–µ–≥–∏</a>
      <a class="kx-btn" href="https://kainrax.netlify.app/#/" target="_blank" rel="noopener">–ö –ø—Ä–æ–µ–∫—Ç—É</a>
      <a class="kx-btn" href="https://t.me/kainrax" target="_blank" rel="noopener nofollow">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è</a>
    </nav>
  </header>

  <main class="kx-shell">
    <section class="kx-panel" id="box">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</section>
  </main>

  <script type="module">
    const themeKey='kx-theme'; (function(){let t='subsurface';try{t=localStorage.getItem(themeKey)||t}catch(_){ }document.documentElement.setAttribute('data-theme',t)})();
    function esc(s){return (s||'').replace(/[&<>"']/g, ch=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch]))}
    function slugify(s){ return String(s||'').trim().toLowerCase().replace(/\s+/g,'-').replace(/[^a-z0-9-_.]+/g,'').slice(0,64) }
    function parseHash(){const raw=(location.hash||'').slice(1).replace(/^\//,''); return decodeURIComponent(raw||'').trim()}
    function fmtDayYear(s){
      if(!s) return '';
      const m=String(s).trim().match(/^(\d{3,4})[\s\-_:.\/]+(\d{1,3})(?:.*?(\d{1,2}):(\d{2}))?$/);
      if(m){const yy=+m[1],doy=+m[2];const hh=m[3]?m[3].padStart(2,'0'):'00',mm=m[4]?m[4]:'00';return `${doy}-–π –¥–µ–Ω—å ${yy}-–≥–æ –≥–æ–¥–∞, ${hh}:${mm}`}
      const d=new Date(s); if(!isNaN(d)){const ry=d.getUTCFullYear(); const wy=ry===2024?429:ry===2025?430:(ry-1595); const start=new Date(Date.UTC(ry,0,1)); const doy=Math.floor((d-start)/86400000)+1; const hh=String(d.getHours()).padStart(2,'0'),mm=String(d.getMinutes()).padStart(2,'0'); return `${doy}-–π –¥–µ–Ω—å ${wy}-–≥–æ –≥–æ–¥–∞, ${hh}:${mm}`} return s;
    }
    const EMO=["üõ†Ô∏è","ü™´","üõ∞Ô∏è","üß≠","üåò","üí°","‚öôÔ∏è","üß™","üì°","üß±","ü™ì","‚õìÔ∏è","üßØ","üîß","üî≠","ü™®","üå´Ô∏è","üåä","ü™ô","üúÇ","üúÅ","üúÑ","üúÉ"];
    function hashStr(s){let h=2166136261>>>0; for(let i=0;i<s.length;i++){h^=s.charCodeAt(i); h=Math.imul(h,16777619)} return h>>>0}
    function authorEmoji(name){return EMO[hashStr(name||'anon')%EMO.length]}
    async function j(u){const r=await fetch(u,{cache:'no-store'}); if(!r.ok) throw 0; return r.json()}

    async function render(){
      const box=document.getElementById('box');
      const all = await j('/content/threads-index.json');
      const tag = parseHash();

      // –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–µ–≥–æ–≤
      const map = new Map();
      for (const t of all){
        if ((t.board||'')==='–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏') continue;
        for (const tg of (t.tags||[])){
          map.set(tg, (map.get(tg)||0)+1);
        }
      }
      const tags = Array.from(map.entries()).sort((a,b)=> b[1]-a[1] || a[0].localeCompare(b[0],'ru'));

      if (!tag){
        box.innerHTML = `
          <h1>–¢–µ–≥–∏</h1>
          <div class="tags">
            ${tags.map(([tg,c])=>`<a class="kx-tag" href="#/${encodeURIComponent(tg)}">${esc(tg)} ¬∑ ${c}</a>`).join('')}
          </div>
          <p class="muted">–í—ã–±–µ—Ä–∏ —Ç–µ–≥, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø–æ—Å—Ç—ã.</p>
        `;
        return;
      }

      const items = all.filter(t=> (t.board||'')!=='–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏' && Array.isArray(t.tags) && t.tags.includes(tag))
                       .sort((a,b)=> new Date(b.created)-new Date(a.created));

      const list = items.map(t=>`
        <div class="item">
          <div><a href="/thread.html#/${encodeURIComponent(t.id)}"><strong>${esc(t.title)}</strong></a></div>
          <div class="muted">${fmtDayYear(t.created)} ¬∑ –∞–≤—Ç–æ—Ä: <a href="/author.html#/${encodeURIComponent(t.author_id||slugify(t.author))}">${authorEmoji(t.author)} ${esc(t.author)}</a> ¬∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤: ${t.commentCount||0}</div>
        </div>`).join('');

      box.innerHTML = `
        <h1>–¢–µ–≥: ${esc(tag)}</h1>
        <div class="tags" style="margin-bottom:16px">
          <a class="kx-tag" href="/tags.html">–í—Å–µ —Ç–µ–≥–∏</a>
          ${tags.slice(0,30).map(([tg,c])=>`<a class="kx-tag ${tg===tag?'on':''}" href="#/${encodeURIComponent(tg)}">${esc(tg)} ¬∑ ${c}</a>`).join('')}
        </div>
        ${list || '<div class="muted">–ü–æ—Å—Ç–æ–≤ —Å —ç—Ç–∏–º —Ç–µ–≥–æ–º –ø–æ–∫–∞ –Ω–µ—Ç.</div>'}
      `;
    }

    addEventListener('hashchange', render);
    render();
  </script>
</body>
</html>

<!doctype html>
<html lang="ru" data-theme="subsurface">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>–ü—Ä–æ—Ñ–∏–ª—å ‚Äî –î–æ—Å–∫–∞ —Å–µ–∫—Ç–æ—Ä–∞</title>
  <meta name="theme-color" content="#0b0f14"/>
  <style>
    :root{--bg:#0b0f14;--panel:#0e141d;--text:#e6edf5;--muted:#9fb0c7;--tag:#112131;--link:#bfe9ff;--r:14px;--shadow:0 8px 30px rgba(0,0,0,.35)}
    html,body{height:100%} body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter}
    a{color:var(--link)} .kx-head{position:sticky;top:0;z-index:10;display:flex;align-items:center;justify-content:space-between;padding:10px 16px;background:linear-gradient(180deg,rgba(0,0,0,.35),rgba(0,0,0,0));border-bottom:1px solid rgba(255,255,255,.05)}
    .kx-btn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:12px;background:var(--tag);border:1px solid rgba(255,255,255,.06);color:var(--text)}
    .kx-shell{max-width:900px;margin:0 auto;padding:16px}
    .kx-panel{background:linear-gradient(180deg,rgba(255,255,255,.02),transparent),var(--panel);border:1px solid rgba(255,255,255,.06);border-radius:var(--r);box-shadow:var(--shadow);padding:18px}
    .muted{color:var(--muted)} .kx-list{display:grid;grid-template-columns:1fr;gap:10px;margin-top:12px}
    .item{border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px;background:#0e141d}
  </style>
</head>
<body>
  <header class="kx-head">
    <div style="display:flex;gap:8px">
      <a class="kx-btn" href="/index.html">‚Üê –¢–µ–º—ã</a>
      <a class="kx-btn" href="/people.html">–í—Å–µ –ª—é–¥–∏</a>
    </div>
    <div style="display:flex;gap:8px">
      <a class="kx-btn" href="https://kainrax.netlify.app/#/" target="_blank" rel="noopener">–ö –ø—Ä–æ–µ–∫—Ç—É</a>
      <a class="kx-btn" href="https://t.me/kainrax" target="_blank" rel="noopener nofollow">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è</a>
    </div>
  </header>
  <main class="kx-shell">
    <section class="kx-panel" id="root">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</section>
  </main>
  <script type="module">
    // –î–∞—Ç—ã 429/430 + "430-218 22:17"
    function fmtDayYear(s){
      if(!s) return '';
      const m = String(s).trim().match(/^(\d{3,4})[\s\-_:.\/]+(\d{1,3})(?:.*?(\d{1,2}):(\d{2}))?$/);
      if (m){
        const yy=+m[1], doy=+m[2];
        const hh=m[3]?m[3].padStart(2,'0'):'00', mm=m[4]?m[4]:'00';
        return `${doy}-–π –¥–µ–Ω—å ${yy}-–≥–æ –≥–æ–¥–∞, ${hh}:${mm}`;
      }
      const d = new Date(s);
      if (!isNaN(d)){
        const ry = d.getUTCFullYear();
        const wy = ry===2024 ? 429 : ry===2025 ? 430 : (ry - 1595);
        const start=new Date(Date.UTC(ry,0,1));
        const doy=Math.floor((d - start)/86400000)+1;
        const hh=String(d.getHours()).padStart(2,'0'), mm=String(d.getMinutes()).padStart(2,'0');
        return `${doy}-–π –¥–µ–Ω—å ${wy}-–≥–æ –≥–æ–¥–∞, ${hh}:${mm}`;
      }
      return s;
    }
    function esc(s){return (s||'').replace(/[&<>"']/g, ch=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[ch]))}
    function getId(){ return decodeURIComponent(location.hash.replace(/^#\/?/,'')).trim() }
    async function load(u){ const r=await fetch(u,{cache:'no-store'}); if(!r.ok) throw 0; return await r.json() }

    // —ç–º–æ–¥–∑–∏ –∞–≤—Ç–æ—Ä–∞
    const EMO=["üõ†Ô∏è","ü™´","üõ∞Ô∏è","üß≠","üåò","üí°","‚öôÔ∏è","üß™","üì°","üß±","ü™ì","‚õìÔ∏è","üßØ","üîß","üî≠","ü™®","üå´Ô∏è","üåä","ü™ô","üúÇ","üúÅ","üúÑ","üúÉ"];
    function hashStr(s){let h=2166136261>>>0; for(let i=0;i<s.length;i++){h^=s.charCodeAt(i); h=Math.imul(h,16777619)} return h>>>0}
    function authorEmoji(name){ const i=hashStr(name||'anon')%EMO.length; return EMO[i] }

    async function render(){
      const root=document.getElementById('root'); const id=getId(); if(!id){root.textContent='–ê–≤—Ç–æ—Ä –Ω–µ —É–∫–∞–∑–∞–Ω.';return}
      try{
        const [authors, threads, comments] = await Promise.all([
          load('/content/authors-index.json'),
          load('/content/threads-index.json'),
          load('/content/comments-index.json').catch(()=>[])
        ]);
        const a = authors.find(x=>x.author_id===id);
        if(!a){ root.innerHTML=`<div class="muted">–ù–µ –Ω–∞–π–¥–µ–Ω –∞–≤—Ç–æ—Ä <code>${esc(id)}</code>.</div>`; return }
        const posts = threads.filter(x=>x.author_id===id).sort((x,y)=>(new Date(y.created))-(new Date(x.created)));
        const comms = (comments||[]).filter(c=>c.author_id===id).sort((x,y)=>(new Date(y.created))-(new Date(x.created)));

        const emo=authorEmoji(a.author);
        root.innerHTML = `
          <h1>${emo} ${esc(a.author)}</h1>
          <div class="muted">${posts.length} –ø–æ—Å—Ç., ${comms.length} –∫–æ–º–º.</div>
          <div style="margin-top:14px">
            <h2 style="margin:0 0 8px 0;font-size:18px">–ü–æ—Å—Ç—ã</h2>
            <div class="kx-list">
              ${posts.map(p=>`<div class="item"><a href="/thread.html#/${encodeURIComponent(p.id)}">‚ú∂ ${esc(p.title)}</a><div class="muted" style="margin-top:4px">${fmtDayYear(p.created)} ¬∑ —Å–µ–∫—Ç–æ—Ä: ${esc(p.sector||'‚Äî')}${p.board?` ¬∑ —Ä–∞–∑–¥–µ–ª: ${esc(p.board)}`:''}</div></div>`).join('') || '<div class="muted">–ù–µ—Ç –ø–æ—Å—Ç–æ–≤.</div>'}
            </div>
          </div>
          <div style="margin-top:18px">
            <h2 style="margin:0 0 8px 0;font-size:18px">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h2>
            <div class="kx-list">
              ${comms.map(c=>`<div class="item">
                <div class="muted">${fmtDayYear(c.created)} ¬∑ –∫ —Ç–µ–º–µ <a href="/thread.html#/${encodeURIComponent(c.thread_id)}?c=${encodeURIComponent(c.comment_id||'')}">${esc(c.thread_title)}</a></div>
                <div style="margin-top:6px">${esc(c.body.slice(0,260))}${c.body.length>260?'‚Ä¶':''}</div>
              </div>`).join('') || '<div class="muted">–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.</div>'}
            </div>
          </div>
        `;
      }catch(_){ root.innerHTML='<div class="muted">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏.</div>' }
    }
    addEventListener('hashchange', render); render();
  </script>
</body>
</html>

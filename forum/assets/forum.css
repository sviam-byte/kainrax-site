:root{
  --bg:#0b0f14;
  --fg:#e6e6e6;
  --muted:#9aa5b1;
  --line:#223042;
  --card:rgba(16,21,32,.95);
  --accent:#7dd3fc;
  --accent2:#a78bfa;
  --ring:#7dd3fc;

  /* тени полегче для GPU */
  --shadow:0 6px 18px rgba(0,0,0,.35);
  --shadow-strong:0 10px 28px rgba(0,0,0,.35);
}

/* базовое */
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:var(--bg);
  color:var(--fg);
  font:16px/1.65 system-ui,-apple-system,Inter,Segoe UI,Roboto,Arial;
  -webkit-text-size-adjust:100%;
  text-size-adjust:100%;
  scrollbar-gutter:stable both-edges;
}
a{color:#93c5fd;text-decoration:none}
a:hover{text-decoration:underline}
:focus-visible{outline:2px solid var(--ring); outline-offset:2px}

/* шапка */
.kx-head{
  position:sticky; top:0; z-index:20;
  display:flex; gap:12px; align-items:center; justify-content:space-between;
  padding:12px 16px;
  border-bottom:1px solid var(--line);
  background:rgba(15,21,32,.95); /* по умолчанию — без blur для мобилок */
}

/* включаем мягкий blur только там, где это дёшево и поддерживается */
@media (min-width: 900px){
  @supports (backdrop-filter: blur(6px)) {
    .kx-head{
      background:linear-gradient(to bottom, rgba(15,21,32,.92), rgba(15,21,32,.7));
      backdrop-filter:saturate(1.05) blur(6px);
      -webkit-backdrop-filter:saturate(1.05) blur(6px);
    }
  }
}

.kx-brand{font-weight:800;letter-spacing:.2px;color:var(--fg);white-space:nowrap}
.kx-nav{display:flex;gap:8px;flex-wrap:wrap}
.kx-btn{
  border:1px solid var(--line);
  background:var(--card);
  color:var(--fg);
  padding:8px 12px;
  border-radius:12px;
  box-shadow:var(--shadow);
  min-height:36px;
}
.kx-btn:hover{transform:translateY(-1px);filter:saturate(1.05)}
.kx-btn.is-active{border-color:rgba(125,211,252,.5)}
.kx-cta{font-weight:600}

/* оболочка/панели */
.kx-shell{max-width:980px;margin:16px auto;padding:0 16px}
.kx-panel{
  position:relative;
  padding:18px;
  border:1px solid var(--line);
  border-radius:16px;
  background:var(--card);
  box-shadow:var(--shadow-strong);
  overflow:hidden;
  isolation:isolate; /* не смешивать эффекты вне панели */
}

/* ВАЖНО: никаких тяжёлых ::after с mix-blend на мобилках */
.kx-panel::after{display:none}

/* сетка карточек */
.kx-grid{display:grid;grid-template-columns:1fr;gap:12px}
@media(min-width:860px){ .kx-grid{grid-template-columns:1fr 1fr} }

.kx-thread{
  border:1px solid rgba(125,211,252,.18);
  border-radius:12px;
  background:linear-gradient(180deg, rgba(125,211,252,.08), transparent);
  padding:12px;
  box-shadow:var(--shadow);
  content-visibility:auto;            /* ленивый рендер */
  contain-intrinsic-size:180px;        /* запас высоты для layout */
  contain:paint;                       /* ограничить перерисовки */
}
.kx-thread .kx-link{display:block;color:var(--fg)}
.kx-title{margin:0 0 4px;font-weight:800}
.kx-sub{font-size:13px;margin-bottom:6px;color:var(--muted)}
.kx-preview{margin:6px 0 8px}
.kx-tags{display:flex;flex-wrap:wrap;gap:6px}
.kx-tag{
  display:inline-flex;align-items:center;gap:6px;
  padding:4px 10px;border:1px solid var(--line);
  border-radius:999px;color:var(--muted);font-size:12px;
}

/* разделители/коды/подписи */
.kx-hr{border:0;border-top:1px solid var(--line);margin:16px 0}
.kx-muted,.muted{color:var(--muted)}
code{background:rgba(255,255,255,.05);padding:.1em .4em;border-radius:6px;border:1px solid var(--line)}

/* комментарии */
.comment{
  border:1px solid var(--line);
  border-radius:10px;
  padding:10px;
  background:var(--card);
  box-shadow:var(--shadow);
  content-visibility:auto;
  contain-intrinsic-size:120px;
  contain:paint;
}

/* пост внутри треда */
.post{
  padding:1rem 1.25rem;
  background:var(--card);
  border-radius:14px;
  box-shadow:var(--shadow-strong);
  border:1px solid var(--line);
  content-visibility:auto;
  contain-intrinsic-size:220px;
  contain:paint;
}
.post + .post{margin-top:1rem}

.post-head{margin-bottom:.5rem}
.post-title{margin:0;font-size:1.1rem;line-height:1.35}
.post-meta{font-size:.85rem;color:var(--muted)}

.post-body{line-height:1.65}
.post-body p{margin:.6rem 0}

/* медиа */
.post-media{margin-top:1rem;position:relative;z-index:1}
.post-media figure{
  margin:0 0 .75rem 0;
  background:rgba(255,255,255,.02);
  border:1px solid rgba(255,255,255,.06);
  border-radius:10px;
  overflow:hidden;
}
.post-media img{
  display:block;
  width:100%;
  height:auto;           /* сохраняем пропорции */
  content-visibility:auto;
}
.post-media figcaption{
  padding:.5rem .75rem;
  font-size:.9rem;
  color:var(--muted);
  text-align:center;
}

/* доступность и адаптация */
@media (max-width: 640px){
  .kx-shell{padding:0 12px}
  .kx-panel{padding:12px}
  .kx-btn{min-height:34px}
  .kx-title{font-size:1rem}
}

/* анимации по просьбе здоровья */
@media (prefers-reduced-motion: reduce){
  *{animation:none !important; transition:none !important}
}

/* вспомогательное: подсветка фокуса якорного коммента */
[data-cid]:target, .comment:focus-within{
  outline:1px solid var(--ring);
  outline-offset:2px;
}

/* тонкая полоса «неба», если используешь её */
#sky-line{
  position:fixed;left:0;right:0;height:3px;z-index:0;pointer-events:none;opacity:.7;
  filter:blur(1px);
  background:radial-gradient(ellipse 80% 150% at 50% 50%, var(--accent) 0%, transparent 40%);
}

/* безопасные акценты для «глитч»-темы без blend-хаоса */
html[data-theme="glitch"] .kx-thread{
  background:linear-gradient(180deg, rgba(167,139,250,.10), transparent);
  border-color:rgba(167,139,250,.22);
}
html[data-theme="glitch"] .kx-tag{
  border-color:rgba(167,139,250,.22);
  color:#b9c2ff;
}
